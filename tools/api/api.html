<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Web:Extend API</title>
	<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/>

	<style type="text/css">
body {background:#fff url(res/wee/bg.png) repeat-x;font-family:Times New Roman,Verdana,serif}
#header {border-bottom:1px dotted #000}
h1 {cursor:pointer;float:left;margin:0}
#navigation {font-size:1.2em;margin:0;padding:.5em;text-align:right}
#navigation li {display:inline;list-style:none;margin-left:.5em}
#navigation a, #navigation a:visited {color:blue;text-decoration:none}
#navigation a:hover, #navigation a:visited:hover {color:black}
#list {border-right:1px dotted #000;float:left;width:17em}
#list ul {padding:0 1em}
#contents {margin-left:18em}
#methodslist, h3 {margin-left:1em}
ul.methods li{margin-bottom:2em}

:link, :visited {border-bottom:1px dotted #bbb;color:#b00;text-decoration:none}
h1:hover, :link:hover, :visited:hover {background-color:#eee;color:#555}

dl {margin-left:1em}
dt {float:left;font-weight:bold;width:5em}
dt:after {content:":"}
dd {margin-left:6em}

table {border:2px solid #ccc;border-collapse:collapse;border-spacing:0;margin:1em}
th, td {border:1px solid #ccc;padding:.2em .4em}
caption {font-weight:bold;text-align:left}
caption:after {content:":"}
pre {background:#f7f7f7;border:1px solid #d7d7d7;margin:1em;overflow:auto;padding:.25em}
	</style>
	<script type="text/javascript" src="res/jquery/jquery.js"></script>
	<script type="text/javascript" src="res/jquery/jquery.history.js"></script>
	<script type="text/javascript">
// Options for the API application
var options = {
	// Location of the API file
	apiFile: "api.xml",
	// Location of the source browser
	srcBaseURL: 'http://wee.extend.ws/browser/trunk/'
};

var api; // Store the API xml file

// Start page
apiHome = function() {
	$('#contents').empty().append('<p>Welcome to <a href="http://wee.extend.ws">Web:Extend</a>\'s API. Please click on the link corresponding to the class or function you want to get details about.</p>');
}

// Format the XML func node given into a PHP function declaration
formatFuncName = function(func) {
	s = '';

	if ($(func).attr('type'))
		s += $(func).attr('type') + ' ';

	if ($(func).attr('visibility'))
		s += $(func).attr('visibility') + ' ';

	s += 'function ' + $(func).attr('name') + '(';

	if ($('>params>param', func).length == 0)
		return s + ')';

	$('>params>param', func).each(function() {
		s += '<span class="param">';
		if ($(this).attr('array')) s += 'array ';
		if ($(this).attr('ref')) s += '&';
		s += '$' + $(this).attr('name');
		if ($(this).attr('default')) s += ' = ' + $(this).attr('default');
		s += '</span>, ';
	});
	return s.substring(0, s.length - 2) + ')';
}

// Write func details to the page at the given destination
writeFuncDetails = function(func, dest, filename) {
	if ($('>comment', func).text())
		$(dest).append('<pre class="comment">' + $('>comment', func).text() + '</pre><dl/>');

	if ($(func).attr('type'))
		$(dest + '>dl').append('<dt>Type</dt><dd>' + $(func).attr('type') + '</dd>');

	if ($(func).attr('filename')) {
		filename = $(func).attr('filename');
		$(dest + '>dl').append('<dt>Filename</dt><dd><a href="' + options.srcBaseURL + filename + '">' + filename + '</a></dd>');
	}

	if ($(func).attr('internal') == undefined)
		$(dest + '>dl').append('<dt>Lines</dt><dd><a href="' + options.srcBaseURL + filename + '#L' + $(func).attr('startline') + '">'
			+ $(func).attr('startline') + ':' + $(func).attr('endline') + '</dd>');
	else
		$(dest + '>dl').append('<dt>Lines</dt><dd>Internal</dd>');

	if ($(func).attr('visibility'))
		$(dest + '>dl').append('<dt>Visibility</dt><dd>' + $(func).attr('visibility') + '</dd>');

	if ($('>params', func).length > 0) {
		$(dest).append('<table class="params"><caption>Parameters</caption><tr><th>Ref?</th><th>Name</th><th>Default</th><th>Comment</th></tr></table>');
		$('>params>param', func).each(function() {
			s = '<tr><td>';
			if ($(this).attr('ref') == undefined) s += ''; else s += '&';
			s += '</td><td>$' + $(this).attr('name') + '</td><td>';
			if ($(this).attr('default') == undefined) s += ''; else s += $(this).attr('default');
			s += '</td><td>' + $(this).text() + '</td></tr>'
			$(dest + '>table.params').append(s);
		});
	}

	if ($('>return', func).length > 0) {
		$(dest).append('<table class="return"><caption>Returns</caption><tr><th>Ref?</th><th>Type</th><th>Comment</th></tr></table>');

		s = '<tr><td>';
		if ($('>return', func).attr('ref')) s += '&'; else s += '';
		s += '</td><td>' + $('>return', func).attr('type') + '</td><td>' + $('>return', func).text() + '</td></tr>';

		$(dest + '>table.return').append(s);
	}

	// TODO: bugs, overloads, sees, throws, todos, warnings
};

// Event called when a class link is clicked
clickClassLink = function(e) {
	$('#contents').empty();

	el = $('classes>class[name="' + e.target.textContent + '"]', api);
	filename = $(el).attr('filename');

	$('#contents').append('<h2 id="' + $(el).attr('name') + '">' + $(el).attr('name') + '</h2>'
		+ '<pre class="comment">' + $('>comment', el).text() + '</pre><dl/>');

	if ($(el).attr('parent')) {
		if ($('a.classLink[href="#' + $(el).attr('parent') + '"]').length > 0) {
			$('#contents>dl').append('<dt>Parent</dt><dd><a href="#' + $(el).attr('parent') + '" class="classLink">' + $(el).attr('parent') + '</a></dd>');
			$('#contents>dl>dd>a.classLink').bind('click', clickClassLink);
		} else
			$('#contents>dl').append('<dt>Parent</dt><dd>' + $(el).attr('parent') + '</dd>');
	}

	if ($(el).attr('type') == undefined)
		$('#contents>dl').append('<dt>Type</dt><dd>class</dd>');
	else
		$('#contents>dl').append('<dt>Type</dt><dd>' + $(el).attr('type') + ' class</dd>');

	$('#contents>dl').append('<dt>Filename</dt><dd><a href="' + options.srcBaseURL + filename + '">' + filename + '</a></dd>'
		+ '<dt>Lines</dt><dd><a href="' + options.srcBaseURL + filename + '#L' + $(el).attr('startline') + '">'
		+ $(el).attr('startline') + ':' + $(el).attr('endline') + '</a></dd>');

	if ($('>implements>implement', el).length > 0) {
		$('#contents').append('<h3>Implements:</h3><ul class="implements"/>');
		$('>implements>implement', el).each(function() {

			if ($('a.classLink[href="#' + $(this).text() + '"]').length > 0) {
				$('#contents>ul.implements').append('<li><a href="#' + $(this).text() + '" class="classLink">' + $(this).text() + '</a></li>');
				$('#contents>ul.implements>li>a.classLink').bind('click', clickClassLink);
			} else
				$('#contents>ul.implements').append('<li>' + $(this).text() + '</li>');
		});
	}

	if ($('>methods>method', el).length > 0) {
		$('#contents').append('<h3>Methods:</h3><div id="methodslist">Go to method: <select class="methods"/></div>');
		$('>methods>method', el).each(function() {
			$('#methodslist>select.methods').append('<option value="' + $(el).attr('name') + '/' + $(this).attr('name') + '">' + $(this).attr('name') + '</option>');
		});
		$('#methodslist>select.methods').bind('change', function(e){
			document.location = '#' + e.target.value;
		});

		$('#contents').append('<ul class="methods"/>');
		$('>methods>method', el).each(function(){
			$('#contents>ul.methods').append('<li><h4 id="' + $(el).attr('name') + '/' + $(this).attr('name') + '">' + formatFuncName(this) + '</h4></li>');
			writeFuncDetails(this, '#contents>ul.methods>li:last-child', filename);
		});
	}
}

// Event called when a function link is clicked
clickFuncLink = function(e) {
	$('#contents').empty();

	el = $('funcs>func[name="' + e.target.textContent + '"]', api);

	$('#contents').append('<h2 id="' + $(el).attr('name') + '">' + formatFuncName(el) + '</h2>');
	writeFuncDetails(el, '#contents', $(el).attr('filename'));
}

// Function called when the hash part of the URL changes
hashChange = function(loc) {
	if (loc != '') {
		spl = loc.split('/');

		if (spl[0] == 'func')
			$('li>a[href="#' + loc + '"]').click();
		else {
			$('li>a[href="#' + spl[0] + '"]').click();
			if (spl[1] != undefined)
				ti = window.setTimeout("$('select.methods').val(loc).change();", 100);
		}
	}
}

// Called when document is ready
$(function() {
	$.ajax({
		url: options.apiFile,
		dataType: "xml",
		error: function(){$('#contents').empty().append('<p>An error occurred while trying to load the API file. Does the file exist?</p>');},
		success: function(xml){
			api = xml;

			$('funcs>func', xml).each(function(){
				$('#funcs').append('<li><a class="funcLink" href="#func/' + $(this).attr('name') + '">' + $(this).attr('name') + '</a></li>');
			});

			$('classes>class', xml).each(function(){
				$('#classes').append('<li><a class="classLink" href="#' + $(this).attr('name') + '">' + $(this).attr('name') + '</a></li>');
			});

			$('h1').bind('click', apiHome);
			$('a.classLink').bind('click', clickClassLink);
			$('a.funcLink').bind('click', clickFuncLink);

			apiHome();

			// Handling of the next/back buttons
			$.historyInit(hashChange);
			hashChange(document.location.hash.substring(1));
		}
	});
});
	</script>
</head>

<body>
<div id="container">
	<div id="header">
		<h1>Web:Extend API</h1>
		<ul id="navigation">
			<li><a href="https://sourceforge.net/project/showfiles.php?group_id=212065">Download</a></li>
			<li><a href="http://wee.extend.ws/wiki/Documentation">Documentation</a></li>
			<li><a href="http://api.extend.ws">API</a></li>
			<li><a href="http://groups.google.com/group/wee-users">Mailing List</a></li>
			<li><a href="http://blog.extend.ws">Blog</a></li>
		</ul>
	</div>
	<div id="list">
		<ul id="funcs"></ul>
		<ul id="classes"></ul>
	</div>
	<div id="contents">
		<p>Please wait while the API file is loading.</p>
	</div>
</div>
</body>
</html>
